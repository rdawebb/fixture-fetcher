<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Fixture Fetcher</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <h1>üóìÔ∏è Fixture Fetcher ‚öΩÔ∏è</h1>

    <div class="instructions">
      <p>
        Use these URLs to subscribe in Google, Apple, or your calendar of choice.
        Click on a link to get the calendar URL, or click the download button to get the .ics file.
      </p>
    </div>

    <div id="loading" class="loading">
      Loading calendars...
    </div>
    <div id="content"></div>
    <div id="error"></div>

    <script>
      function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
          alert('Calendar URL copied to clipboard!');
        }).catch(err => {
          alert('Failed to copy link');
        });
      }

      function downloadIcs(fileUrl) {
        const link = document.createElement('a');
        link.href = fileUrl;
        link.download = '';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }

      async function loadCalendars() {
        const contentDiv = document.getElementById('content');
        const errorDiv = document.getElementById('error');
        const loadingDiv = document.getElementById('loading');

        try {
          const response = await fetch('calendars.json');
          if (!response.ok) {
            throw new Error(`Failed to load calendars: ${response.status}`);
          }

          const data = await response.json();

          if (!data.calendars || data.calendars.length === 0) {
            loadingDiv.textContent = 'No calendars available yet.';
            return;
          }

          loadingDiv.style.display = 'none';
          contentDiv.innerHTML = data.calendars.map(league => `
            <div class="league-section">
              <h2>${league.league}</h2>
              ${league.teams.map(team => `
                <div class="team-section">
                  <div class="team-name">${team.name}</div>
                  <ul class="competitions-list">
                    ${team.competitions.map(comp => {
                      const calendarUrl = location.origin + '/' + comp.url.replace(/^\/+/, '');
                      return `
                        <li>
                          <button onclick="copyToClipboard('${calendarUrl}')">${comp.name}</button>
                          <button onclick="downloadIcs('${comp.url}')" title="Download .ics file" class="download-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 32 32">
                              <path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M16 22V5"/>
                              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 16l7 7 7-7M9 27h14"/>
                            </svg>
                          </button>
                        </li>
                      `;
                    }).join('')}
                  </ul>
                </div>
              `).join('')}
            </div>
          `).join('');

        } catch (err) {
          loadingDiv.style.display = 'none';
          errorDiv.className = 'error';
          errorDiv.innerHTML = `<strong>Error loading calendars:</strong> ${err.message}`;
          console.error('Error loading calendars:', err);
        }
      }

      // Load calendars when page loads
      document.addEventListener('DOMContentLoaded', loadCalendars);
    </script>
  </body>
</html>
